## RADIUS Server with MySQL:

Below is a complete, practical guide to set up FreeRADIUS with MySQL (MariaDB) on Rocky Linux.


### When MySQL is Needed:

You need **MySQL (or MariaDB / PostgreSQL)** only if you want:

- Centralized user database
- Dynamic policies
- Accounting records (who connected, how long, how much data)
- ISP / hotspot / billing systems
- Large-scale deployments

_Typical uses:_
- ISP broadband users
- Captive portal / hotspot
- Bandwidth control
- Long-term session logging



### FreeRADIUS Backend Options (No DB vs DB):

| Backend          | MySQL Needed | Use Case        |
| ---------------- | ------------ | --------------- |
| users file       | ❌ No         | Small / testing |
| Active Directory | ❌ No         | Enterprise      |
| LDAP             | ❌ No         | Corporate       |
| MySQL / MariaDB  | ✅ Yes        | ISP / Hotspot   |
| PostgreSQL       | ✅ Yes        | Large / HA      |
| Redis            | ❌ No         | Cache only      |





## Install Apache:

```
dnf install -y httpd
```


```
systemctl enable httpd
systemctl start httpd
```


## Install PHP:

_Enable the Remi Repository:_
```
dnf install -y dnf-utils 
dnf install -y http://rpms.remirepo.net/enterprise/remi-release-8.rpm
```


```
dnf module list -y php
dnf module reset -y php
```


```
dnf module enable php:remi-7.4
```


_Install PHP and some popular PHP extensions:_
```
dnf -y install php-{common,opcache,cli,gd,curl,mysqlnd,devel,pear,mbstring,xml,zip}
```


_To install the DB and MDB2 libraries from the PEAR repository. These are required by **daloRADIUS** to work:_
```
pear install DB 
pear install MDB2
```



```
php -v
```


```
dnf install -y php-fpm
```


```
systemctl enable php-fpm
systemctl start php-fpm
systemctl status php-fpm
```




## Install MySQL: 

```
yum module list -y mysql

yum module enable -y mysql:8.0
```


```
yum install mysql-server -y
```


```
systemctl start mysqld 
systemctl enable mysqld 
systemctl status mysqld 
```



```
mysql -u root

CREATE DATABASE radius;

CREATE USER 'radius'@'localhost' IDENTIFIED BY 'Admin@321';

GRANT ALL PRIVILEGES ON radius.* TO 'radius'@'localhost';

FLUSH PRIVILEGES;
```


## Installing FreeRADIUS: 

```
dnf module list -y freeradius
```


```
dnf install -y freeradius freeradius-utils freeradius-mysql
```


```
systemctl enable radiusd
systemctl start radiusd
systemctl status radiusd
```



### Configure FreeRADIUS:

_Import the RADIUS MySQL schema into the newly created database:_
```
mysql -u root radius < /etc/raddb/mods-config/sql/main/mysql/schema.sql
```



_Create a soft link for SQL under `/etc/raddb/mods-enabled`:_
```
ln -s /etc/raddb/mods-available/sql /etc/raddb/mods-enabled/
```



_Configure SQL module `/raddb/mods-available/sql` and change the database connection parameters to suite your environment:_
- Change d`river = "rlm_sql_null"` to `driver = "rlm_sql_mysql"`
- Change `dialect = "sqlite"` to `dialect = "mysql"`

```
vim /etc/raddb/mods-available/sql

sql {

    ### Line 40: 
        dialect = "mysql"

    ### Line 61: 
        driver = "rlm_sql_mysql"
    

    ### Line 85: 
        ## Comment MySQL SSL settings and tls section commented out: 
        mysql {
                # If any of the files below are set, TLS encryption is enabled
#               tls {
#                       ca_file = "/etc/ssl/certs/my_ca.crt"
#                       ca_path = "/etc/ssl/certs/"
#                       certificate_file = "/etc/ssl/certs/private/client.crt"
#                       private_key_file = "/etc/ssl/certs/private/client.key"
#                       cipher = "DHE-RSA-AES256-SHA:AES128-SHA"
#
#                       tls_required = yes
#                       tls_check_cert = no
#                       tls_check_cert_cn = no
#               }

                # If yes, (or auto and libmysqlclient reports warnings are
                # available), will retrieve and log additional warnings from
                # the server if an error has occured. Defaults to 'auto'
                warnings = auto
        }


    ### Line 157: 
        # Connection info:
        server = "localhost"
        port = 3306
        login = "radius"
        password = "Admin@321"

        radius_db = "radius"


    ### Line 323: 
        # Set to 'yes' to read radius clients from the database ('nas' table)
        # Clients will ONLY be read on server startup.
        read_clients = yes

        # Table to keep radius client info
        client_table = "nas"
}

```



_Now change the group rights of the file we just edited to `radiusd`:_
```
chgrp -h radiusd /etc/raddb/mods-enabled/sql
```


```
systemctl restart radiusd
```


_Stop the `radiusd` service:_
```
systemctl stop radiusd
```



_To run it in debug mode:_
```
radiusd -X


### Output:

Listening on auth address * port 1812 bound to server default
Listening on acct address * port 1813 bound to server default
Listening on auth address :: port 1812 bound to server default
Listening on acct address :: port 1813 bound to server default
Listening on auth address 127.0.0.1 port 18120 bound to server inner-tunnel
Listening on proxy address * port 53137
Listening on proxy address :: port 53512
Ready to process requests
```


Now FreeRADIUS is installed and working with MySQL or MariaDB on your Rocky Linux.




---
---



## Install and Configure Daloradius (Optional):

You can use **Daloradius** to manage radius server from a web interface. This is an optional configuration which you can select depending on your use case.


```
git clone https://github.com/lirantal/daloradius.git
```


Or,

```
cd /tmp

wget https://github.com/lirantal/daloradius/archive/master.zip
wget https://github.com/lirantal/daloradius/archive/refs/tags/1.3.zip

unzip master.zip

mv daloradius-master/ /var/www/html/daloradius
```


_Import Daloradius mysql tables:_
```
cd /var/www/html/daloradius

mysql -u root radius < contrib/db/fr2-mysql-daloradius-and-freeradius.sql
mysql -u root radius < contrib/db/mysql-daloradius.sql

Or,

mysql -u root radius < contrib/db/fr3-mariadb-freeradius.sql
mysql -u root radius < contrib/db/mariadb-daloradius.sql
```


```
cd /var/www/html/daloradius/library/
cp daloradius.conf.php.sample daloradius.conf.php

Or,

cd /var/www/html/daloradius/app/common/includes
cp daloradius.conf.php.sample daloradius.conf.php
```



_Set database name, user and password for connection:_
```
vim daloradius.conf.php

$configValues['CONFIG_DB_HOST'] = 'localhost';
$configValues['CONFIG_DB_PORT'] = '3306';
$configValues['CONFIG_DB_USER'] = 'radius';
$configValues['CONFIG_DB_PASS'] = 'Admin@321';
$configValues['CONFIG_DB_NAME'] = 'radius';
```



```
chown -R apache:apache /var/www/html/daloradius
```



```
systemctl restart radiusd
systemctl restart httpd

systemctl status radiusd httpd
```






### Configure Apache web server:


```
vim /etc/httpd/conf/httpd.conf


Listen 80
Listen 8000    ### Add this line
```


_Configure virtual host for operators module:_
```
vim /etc/httpd/conf.d/operators.conf


<VirtualHost *:8000>
    ServerName 192.168.10.193
    ServerAdmin operators@localhost
    DocumentRoot /var/www/html/daloradius/app/operators

    <Directory /var/www/html/daloradius/app/operators>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    <Directory /var/www/html/daloradius>
        Require all denied
    </Directory>

    ErrorLog /var/log/httpd/daloradius/operators/error.log
    CustomLog /var/log/httpd/daloradius/operators/access.log combined
</VirtualHost>
```



_Next we create virtual host for users:_
```
vim /etc/httpd/conf.d/users.conf


<VirtualHost *:80>
    ServerName 192.168.10.193
    ServerAdmin users@localhost
    DocumentRoot /var/www/html/daloradius/app/users

    <Directory /var/www/html/daloradius/app/users>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    <Directory /var/www/html/daloradius>
        Require all denied
    </Directory>

    ErrorLog /var/log/httpd/daloradius/users/error.log
    CustomLog /var/log/httpd/daloradius/users/access.log combined
</VirtualHost>
```


```
mkdir -p /var/log/httpd/daloradius/users
mkdir -p /var/log/httpd/daloradius/operators

chown -R apache:apache /var/log/httpd/daloradius
```


```
httpd -t
```


```
rm /etc/httpd/conf.d/welcome.conf
```



```
systemctl restart radiusd
systemctl restart httpd

systemctl status radiusd 
systemctl status httpd
```



### daloRADIUS Web Console: 

To login use the default daloRADIUS username/password:
- username: administrator
- password: radius


**Now access daloradius with below URLs:** 
```
RADIUS management application: http://<ip>:8000

RADIUS user portal application: http://<ip>
```







